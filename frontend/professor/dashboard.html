<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel do Professor - GT JIU</title>
  <link rel="stylesheet" href="../css/style.css">

  <style>
    body {
      margin: 0;
      background: #050505;
      color: #f5f5ff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 40px 16px 60px;
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .btn {
      border-radius: 999px;
      padding: 8px 16px;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .btn-sec { background: #333; color: #fff; }
    .btn-danger { background: #b71c1c; color: #fff; }
    .btn-light { background: #eee; color: #111; }

    .cards {
      margin-top: 25px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .card {
      background: #181818;
      padding: 18px;
      border-radius: 12px;
      text-align: left;
      box-shadow: 0 10px 30px rgba(0,0,0,0.7);
    }

    .card h3 { margin: 0 0 6px; font-size: 18px; }
    .card p { margin: 0; opacity: 0.9; }

    /* cards clicÃ¡veis */
    .card-link {
      cursor: pointer;
      transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
    }
    .card-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 18px 40px rgba(0,0,0,0.85);
      background: #202020;
    }

    @media (min-width: 768px) {
      .cards { flex-direction: row; }
      .card { flex: 1; }
    }

    /* --- AVISOS & CRONÃ”METRO --- */
    .painel-extra {
      margin-top: 30px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    @media (min-width: 900px) {
      .painel-extra { flex-direction: row; }
      .box { flex: 1; }
    }

    .box {
      background: #181818;
      padding: 16px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.7);
    }

    .input-text, .textarea {
      width: 100%;
      border-radius: 8px;
      border: 1px solid #333;
      background: #101010;
      color: #fff;
      padding: 8px;
      margin-bottom: 8px;
      outline: none;
    }

    .textarea { resize: vertical; min-height: 60px; }

    .avisos-lista {
      margin-top: 10px;
      max-height: 220px;
      overflow-y: auto;
    }

    .aviso-item {
      border-top: 1px solid #333;
      padding: 6px 0;
    }

    .aviso-titulo { font-weight: 600; }
    .aviso-data { opacity: 0.7; font-size: 0.8rem; }
    .btn-mini {
      font-size: 0.75rem;
      padding: 3px 8px;
      border-radius: 999px;
      background: #333;
      border: none;
      cursor: pointer;
      margin-top: 4px;
    }

    /* --- CRONÃ”METRO --- */
    .timer-display-wrapper {
      background: radial-gradient(circle at top, #202838 0, #101010 55%, #050505 100%);
      border-radius: 16px;
      padding: 18px;
      border: 1px solid #ffffff1a;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.9);
    }

    .timer-display {
      font-size: 3.4rem;
      font-weight: 700;
      background: #050505;
      border-radius: 12px;
      padding: 6px 18px;
      border: 2px solid #ffffff33;
      min-width: 230px;
      margin: 10px auto;
      transition: 0.2s;
    }

    .timer-rodando { color: #00e676; border-color: #00e676; }
    .timer-alerta { color: #ffeb3b; border-color: #ffeb3b; }
    .timer-encerrado { color: #ff5252; border-color: #ff5252; }

    .timer-buttons, .timer-presets {
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .badge {
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: #ffffff10;
      border: 1px solid #ffffff30;
      display: inline-block;
      margin-top: 6px;
    }
  </style>
</head>
<body>

<!-- ðŸ”Š SOM â€” GONGO REAL -->
<audio id="gongoSound" preload="auto">
  <source src="data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCAhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISMP/AABEIAKgBKwMBIgACEQEDEQH/xAAYAAADAQEAAAAAAAAAAAAAAAAABQcEAv/EAB0QAQEBAQACAwAAAAAAAAAAAAABAgMEBREhEzH/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/xAAZEQEBAAMBAAAAAAAAAAAAAAAAAHECEUH/2gAMAwEAAhEDEQA/APpwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAM8v7q95FbOYf/Z" type="audio/mp3">
</audio>

<div class="container">

  <div class="topbar">
    <div>
      <h1>Painel do Professor</h1>
      <p id="subtituloProf" style="opacity:0.8;"></p>
    </div>
    <button class="btn btn-sec" onclick="sairProfessor()">Sair</button>
  </div>

  <!-- CARDS PRINCIPAIS -->
  <div class="cards">
    <div class="card card-link" onclick="irParaAlunos()">
      <h3>Alunos</h3>
      <p>Cadastro de alunos, planos e mensalidades.</p>
    </div>
    <div class="card card-link" onclick="irParaMedalhas()">
      <h3>Medalhas</h3>
      <p>Valide medalhas enviadas e acompanhe o desempenho.</p>
    </div>
    <div class="card card-link" onclick="irParaRanking()">
      <h3>Ranking</h3>
      <p>Ranking interno de medalhas da sua academia.</p>
    </div>
  </div>

  <!-- AVISOS + CRONÃ”METRO -->
  <div class="painel-extra">

    <!-- AVISOS -->
    <section class="box">
      <h2>Avisos para os alunos</h2>
      <input id="avisoTitulo" class="input-text" placeholder="TÃ­tulo do aviso">
      <textarea id="avisoTexto" class="textarea" placeholder="Digite seu aviso..."></textarea>
      <button class="btn btn-sec" onclick="publicarAviso()">Publicar aviso</button>

      <div id="listaAvisos" class="avisos-lista"></div>
    </section>

    <!-- CRONÃ”METRO -->
    <section class="box">
      <h2>CronÃ´metro de Luta</h2>

      <div class="timer-display-wrapper">
        <div id="timerDisplay" class="timer-display">05:00</div>
        <div id="timerStatus" style="opacity:0.8;">Pronto para iniciar</div>
      </div>

      <div style="margin-top:10px;text-align:center;">
        <input id="timerMinutos" type="number" min="0" value="5"
               style="width:60px;background:#101010;color:#fff;border:1px solid #444;padding:4px;border-radius:8px;">
        :
        <input id="timerSegundos" type="number" min="0" max="59" value="0"
               style="width:60px;background:#101010;color:#fff;border:1px solid #444;padding:4px;border-radius:8px;">
      </div>

      <div class="timer-buttons">
        <button class="btn btn-light" onclick="iniciarTimer()">Iniciar</button>
        <button class="btn btn-sec" onclick="pausarTimer()">Pausar</button>
        <button class="btn btn-danger" onclick="resetarTimer()">Zerar</button>
      </div>

      <div class="timer-presets">
        <button class="btn-mini" onclick="setPreset(5,0)">5:00</button>
        <button class="btn-mini" onclick="setPreset(6,0)">6:00</button>
        <button class="btn-mini" onclick="setPreset(8,0)">8:00</button>
        <button class="btn-mini" onclick="setPreset(10,0)">10:00</button>
      </div>

      <span class="badge">Gongo forte no inÃ­cio e 3 gongos no final</span>
    </section>

  </div>
</div>

<script>
/* ====================== LOGIN ======================= */
const profStr = localStorage.getItem('gtjiu_professor_logado');
if (!profStr) {
  alert("VocÃª precisa estar logado como professor.");
  window.location.href = "login.html";
}
const prof = JSON.parse(profStr);
document.getElementById("subtituloProf").textContent = `${prof.nome} (${prof.email})`;

function sairProfessor() {
  localStorage.removeItem('gtjiu_professor_logado');
  window.location.href = "login.html";
}

/* ====== NAVEGAÃ‡ÃƒO ====== */
function irParaAlunos()   { window.location.href = "alunos.html"; }
function irParaMedalhas() { window.location.href = "medalhas.html"; }
function irParaRanking()  { window.location.href = "medalhas.html#ranking"; }

/* ====================== AVISOS ======================= */
function getAvisos() {
  return JSON.parse(localStorage.getItem('gtjiu_avisos') || '[]');
}
function salvarAvisos(lista) {
  localStorage.setItem('gtjiu_avisos', JSON.stringify(lista));
}

function publicarAviso() {
  const titulo = document.getElementById('avisoTitulo').value.trim();
  const texto  = document.getElementById('avisoTexto').value.trim();

  if (!texto) {
    alert("Escreva algo para publicar.");
    return;
  }

  const avisos = getAvisos();
  avisos.push({
    id: Date.now(),
    professorEmail: prof.email,
    titulo: titulo || "Aviso",
    texto,
    criadoEm: new Date().toISOString()
  });
  salvarAvisos(avisos);

  document.getElementById('avisoTitulo').value = "";
  document.getElementById('avisoTexto').value = "";

  renderAvisos();
}

function removerAviso(id) {
  let avisos = getAvisos();
  avisos = avisos.filter(a => a.id !== id);
  salvarAvisos(avisos);
  renderAvisos();
}
window.removerAviso = removerAviso;

function renderAvisos() {
  const container = document.getElementById('listaAvisos');
  container.innerHTML = "";

  const avisos = getAvisos()
    .filter(a => a.professorEmail === prof.email)
    .sort((a,b) => b.id - a.id);

  if (avisos.length === 0) {
    container.innerHTML = '<p style="opacity:0.7">Nenhum aviso publicado.</p>';
    return;
  }

  avisos.forEach(a => {
    const div = document.createElement('div');
    div.className = 'aviso-item';
    div.innerHTML = `
      <div class="aviso-titulo">${a.titulo}</div>
      <div class="aviso-data">${new Date(a.criadoEm).toLocaleString("pt-BR")}</div>
      <div class="aviso-texto">${a.texto}</div>
      <button class="btn-mini" onclick="removerAviso(${a.id})">Remover</button>
    `;
    container.appendChild(div);
  });
}
renderAvisos();

/* ====================== CRONÃ”METRO ======================= */
let timerInterval = null;
let timerSegundosRestantes = 5 * 60;

const display = document.getElementById("timerDisplay");
const statusLabel = document.getElementById("timerStatus");
const minInput = document.getElementById("timerMinutos");
const segInput = document.getElementById("timerSegundos");

/* --- SOM DE GONGO REAL --- */
function tocarGongo(qtd = 1) {
  const audio = document.getElementById("gongoSound");
  let count = 0;

  function tocar() {
    audio.currentTime = 0;
    audio.volume = 1.0;
    audio.play();
    count++;
    if (count < qtd) setTimeout(tocar, 900);
  }
  tocar();
}

/* --- TIMER --- */
function atualizarDisplay() {
  const m = String(Math.floor(timerSegundosRestantes / 60)).padStart(2,'0');
  const s = String(timerSegundosRestantes % 60).padStart(2,'0');
  display.textContent = `${m}:${s}`;

  display.classList.remove("timer-rodando","timer-alerta","timer-encerrado");

  if (timerSegundosRestantes === 0) {
    display.classList.add("timer-encerrado");
    statusLabel.textContent = "Tempo encerrado";
  } else if (timerSegundosRestantes <= 10) {
    display.classList.add("timer-alerta");
    statusLabel.textContent = "Ãšltimos segundos!";
  } else if (timerInterval) {
    display.classList.add("timer-rodando");
    statusLabel.textContent = "Luta em andamento";
  } else {
    statusLabel.textContent = "Pronto para iniciar";
  }
}

function setPreset(min,sec){
  minInput.value=min;
  segInput.value=sec;
  timerSegundosRestantes=min*60+sec;
  atualizarDisplay();
}
window.setPreset=setPreset;

function iniciarTimer() {
  const min = parseInt(minInput.value)||0;
  const seg = parseInt(segInput.value)||0;

  const total = min*60 + seg;
  if (total <= 0) {
    alert("Defina um tempo vÃ¡lido.");
    return;
  }

  timerSegundosRestantes = total;
  atualizarDisplay();

  if (timerInterval) clearInterval(timerInterval);

  /* Gongo de inÃ­cio */
  tocarGongo(1);

  timerInterval = setInterval(() => {
    timerSegundosRestantes--;

    if (timerSegundosRestantes <= 0) {
      timerSegundosRestantes = 0;
      clearInterval(timerInterval);
      timerInterval = null;
      atualizarDisplay();

      /* Gongo final (3x) */
      tocarGongo(3);
      return;
    }

    atualizarDisplay();
  },1000);
}

function pausarTimer(){
  if(timerInterval){
    clearInterval(timerInterval);
    timerInterval=null;
  }
  atualizarDisplay();
}
function resetarTimer(){
  pausarTimer();
  timerSegundosRestantes=(parseInt(minInput.value)||0)*60 + (parseInt(segInput.value)||0);
  atualizarDisplay();
}

window.iniciarTimer=iniciarTimer;
window.pausarTimer=pausarTimer;
window.resetarTimer=resetarTimer;

atualizarDisplay();
</script>

</body>
</html>
