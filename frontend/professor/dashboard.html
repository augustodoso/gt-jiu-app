<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel do Professor - GT Jiu</title>
  <link rel="stylesheet" href="../css/style.css">
  <style>
    body {
      background: #000;
      color: #f5f5f5;
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 40px 20px 80px;
    }
    .topo {
      display: flex;
      justify-content: center;
      position: relative;
      margin-bottom: 30px;
      text-align: center;
    }
    .topo h1 {
      margin: 0;
      font-size: 36px;
      line-height: 1.2;
    }
    .btn-sair {
      position: absolute;
      right: 0;
      top: 0;
    }
    .btn {
      background: #ff4444;
      border: none;
      color: #fff;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }
    .btn:hover {
      opacity: 0.9;
    }

    .nome-prof {
      text-align: center;
      margin-bottom: 30px;
      font-size: 15px;
      opacity: 0.9;
    }

    .cards-topo {
      display: grid;
      /* agora só 3 cards: Alunos, Medalhas, Academias */
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 16px;
      margin-bottom: 30px;
    }
    .card-topo {
      background: #181818;
      border-radius: 12px;
      padding: 18px 16px;
      text-align: center;
      cursor: pointer;
      transition: transform 0.15s, box-shadow 0.15s, background 0.15s;
    }
    .card-topo h2 {
      margin: 0 0 8px;
      font-size: 20px;
    }
    .card-topo p {
      margin: 0;
      font-size: 13px;
      opacity: 0.9;
    }
    .card-topo:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.6);
      background: #202020;
    }

    .grade-baixo {
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 20px;
      align-items: stretch;
    }
    .box {
      background: #181818;
      border-radius: 14px;
      padding: 18px 18px 22px;
    }
    .box h2 {
      margin: 0 0 10px;
      font-size: 20px;
    }
    .box p {
      font-size: 13px;
      opacity: 0.9;
    }

    /* Avisos */
    .campo-titulo,
    .campo-texto {
      width: 100%;
      border-radius: 8px;
      border: none;
      padding: 10px 12px;
      margin-top: 10px;
      font-size: 14px;
      background: #101010;
      color: #fff;
    }
    .campo-texto {
      resize: vertical;
      min-height: 80px;
      max-height: 150px;
    }
    .lista-avisos {
      margin-top: 14px;
      font-size: 13px;
      border-top: 1px solid #333;
      padding-top: 10px;
      max-height: 160px;
      overflow-y: auto;
    }
    .aviso-item {
      margin-bottom: 6px;
    }
    .aviso-item strong {
      color: #ff6b6b;
    }

    /* Cronômetro */
    .timer-display {
      margin-top: 15px;
      margin-bottom: 6px;
      font-size: 48px;
      text-align: center;
      font-weight: 700;
    }
    .timer-status {
      text-align: center;
      font-size: 12px;
      opacity: 0.85;
      margin-bottom: 12px;
    }
    .timer-controles {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 12px;
    }
    .timer-controles button {
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
    }
    .btn-start {
      background: #22c55e;
      color: #000;
    }
    .btn-pause {
      background: #facc15;
      color: #000;
    }
    .btn-reset {
      background: #ef4444;
      color: #fff;
    }
    .timer-config {
      display: flex;
      justify-content: center;
      gap: 6px;
      font-size: 13px;
      margin-bottom: 8px;
    }
    .timer-config input {
      width: 48px;
      padding: 4px 6px;
      border-radius: 6px;
      border: none;
      background: #101010;
      color: #fff;
      text-align: center;
    }
    .timer-presets {
      display: flex;
      justify-content: center;
      gap: 6px;
      font-size: 11px;
      margin-top: 4px;
    }
    .timer-presets button {
      border: none;
      border-radius: 999px;
      padding: 3px 10px;
      background: #262626;
      color: #fff;
      cursor: pointer;
    }
    .timer-presets button:hover {
      background: #333;
    }

    @media (max-width: 900px) {
      .cards-topo {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
      .grade-baixo {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 640px) {
      .cards-topo {
        grid-template-columns: 1fr;
      }
      .topo h1 {
        font-size: 28px;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <div class="topo">
    <h1>Painel do Professor</h1>
    <button class="btn btn-sair" onclick="sairProfessor()">Sair</button>
  </div>

  <div class="nome-prof" id="infoProfessor"></div>

  <!-- CARDS SUPERIORES -->
  <div class="cards-topo">
    <div class="card-topo" onclick="irAlunos()">
      <h2>Alunos</h2>
      <p>Cadastro de alunos, planos e mensalidades.</p>
    </div>

    <div class="card-topo" onclick="irMedalhas()">
      <h2>Medalhas</h2>
      <p>Valide medalhas enviadas e acompanhe o desempenho.</p>
    </div>

    <!-- REMOVIDO: RANKING -->
    <div class="card-topo" onclick="irAcademias()">
      <h2>Academias</h2>
      <p>Cadastre sua academia e atualize dados públicos.</p>
    </div>
  </div>

  <div class="grade-baixo">
    <!-- AVISOS -->
    <div class="box">
      <h2>Avisos para os alunos</h2>
      <p>Os avisos aparecem no painel dos alunos vinculados ao seu e-mail.</p>

      <input id="tituloAviso" class="campo-titulo" placeholder="Título do aviso (opcional)">
      <textarea id="textoAviso" class="campo-texto" placeholder="Digite seu aviso..."></textarea>

      <div style="margin-top: 10px;">
        <button class="btn" onclick="publicarAviso()">Publicar aviso</button>
      </div>

      <div class="lista-avisos" id="listaAvisos">
        Nenhum aviso publicado ainda.
      </div>
    </div>

    <!-- CRONÔMETRO -->
    <div class="box">
      <h2>Cronômetro de Luta</h2>
      <p>Estilo placar de campeonato. Ideal para rounds de rola e treinos específicos.</p>

      <div class="timer-display" id="displayTempo">05:00</div>
      <div class="timer-status" id="statusTimer">Pronto para iniciar</div>

      <div class="timer-controles">
        <button class="btn-start" onclick="iniciarTimer()">Iniciar</button>
        <button class="btn-pause" onclick="pausarTimer()">Pausar</button>
        <button class="btn-reset" onclick="zerarTimer()">Zerar</button>
      </div>

      <div class="timer-config">
        <span>Min</span>
        <input type="number" id="minInput" value="5" min="0" max="20">
        <span>Seg</span>
        <input type="number" id="segInput" value="0" min="0" max="59">
      </div>

      <div class="timer-presets">
        <button onclick="setPreset(5,0)">5:00</button>
        <button onclick="setPreset(6,0)">6:00</button>
        <button onclick="setPreset(8,0)">8:00</button>
        <button onclick="setPreset(10,0)">10:00</button>
      </div>
    </div>
  </div>
</div>

<script>
  // -------- PROTEGE E CARREGA DADOS DO PROFESSOR --------
  const profStr = localStorage.getItem('gtjiu_professor_logado');
  if (!profStr) {
    alert('Você precisa fazer login como professor.');
    window.location.href = 'login.html';
  }
  const prof = JSON.parse(profStr);
  document.getElementById('infoProfessor').textContent =
    `${prof.nome || ''} (${prof.email || ''})`;

  // -------- NAVEGAÇÃO DOS CARDS --------
  function irAlunos() {
    window.location.href = './alunos.html';
  }
  function irMedalhas() {
    window.location.href = './medalhas.html';
  }
  // Ranking removido
  function irAcademias() {
    // agora vai para a tela de cadastro da academia do professor
    window.location.href = './cadastro_academia.html';
  }
  function sairProfessor() {
    localStorage.removeItem('gtjiu_professor_logado');
    window.location.href = 'login.html';
  }

  // -------- AVISOS (LOCALSTORAGE) --------
  const CHAVE_AVISOS = 'gtjiu_avisos';

  function carregarAvisos() {
    const avisos = JSON.parse(localStorage.getItem(CHAVE_AVISOS) || '[]')
      .filter(a => a.professorEmail === prof.email)
      .sort((a, b) => b.criadoEm - a.criadoEm);

    const lista = document.getElementById('listaAvisos');
    if (avisos.length === 0) {
      lista.textContent = 'Nenhum aviso publicado ainda.';
      return;
    }

    lista.innerHTML = '';
    avisos.forEach(aviso => {
      const div = document.createElement('div');
      div.className = 'aviso-item';

      const data = new Date(aviso.criadoEm);
      const dataStr = !isNaN(data) ? data.toLocaleDateString('pt-BR') : '';

      div.innerHTML = `
        <strong>${aviso.titulo || 'Aviso'}</strong>
        ${dataStr ? ' - ' + dataStr : ''}<br>
        ${aviso.texto}
      `;
      lista.appendChild(div);
    });
  }

  function publicarAviso() {
    const titulo = document.getElementById('tituloAviso').value.trim();
    const texto  = document.getElementById('textoAviso').value.trim();

    if (!texto) {
      alert('Digite o texto do aviso.');
      return;
    }

    const avisos = JSON.parse(localStorage.getItem(CHAVE_AVISOS) || '[]');
    avisos.push({
      professorEmail: prof.email,
      titulo,
      texto,
      criadoEm: Date.now()
    });
    localStorage.setItem(CHAVE_AVISOS, JSON.stringify(avisos));

    document.getElementById('tituloAviso').value = '';
    document.getElementById('textoAviso').value  = '';
    carregarAvisos();
  }

  carregarAvisos();

  // -------- CRONÔMETRO --------
  let tempoRestante = 5 * 60; // em segundos
  let timerId = null;
  let rodando = false;

  const displayTempo = document.getElementById('displayTempo');
  const statusTimer  = document.getElementById('statusTimer');
  const minInput     = document.getElementById('minInput');
  const segInput     = document.getElementById('segInput');

  function formatar(segundos) {
    const m = String(Math.floor(segundos / 60)).padStart(2, '0');
    const s = String(segundos % 60).padStart(2, '0');
    return `${m}:${s}`;
  }

  function atualizarDisplay() {
    displayTempo.textContent = formatar(tempoRestante);
  }

  function aplicarInputs() {
    let m = parseInt(minInput.value, 10);
    let s = parseInt(segInput.value, 10);
    if (isNaN(m) || m < 0) m = 0;
    if (isNaN(s) || s < 0) s = 0;
    if (s > 59) s = 59;
    tempoRestante = m * 60 + s;
    atualizarDisplay();
  }

  minInput.addEventListener('change', aplicarInputs);
  segInput.addEventListener('change', aplicarInputs);

  function setPreset(m, s) {
    minInput.value = m;
    segInput.value = s;
    aplicarInputs();
  }

  function tick() {
    if (tempoRestante > 0) {
      tempoRestante--;
      atualizarDisplay();
    } else {
      clearInterval(timerId);
      timerId = null;
      rodando = false;
      statusTimer.textContent = 'Tempo encerrado';
      // aqui entra o som de gongo se você quiser no futuro
    }
  }

  function iniciarTimer() {
    aplicarInputs();
    if (rodando) return;
    if (tempoRestante <= 0) return;
    rodando = true;
    statusTimer.textContent = 'Cronômetro rodando';
    timerId = setInterval(tick, 1000);
  }

  function pausarTimer() {
    if (!rodando) return;
    rodando = false;
    statusTimer.textContent = 'Cronômetro pausado';
    clearInterval(timerId);
    timerId = null;
  }

  function zerarTimer() {
    rodando = false;
    clearInterval(timerId);
    timerId = null;
    aplicarInputs();
    statusTimer.textContent = 'Pronto para iniciar';
  }

  atualizarDisplay();
</script>

</body>
</html>
